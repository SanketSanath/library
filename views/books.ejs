<!DOCTYPE html>
<html>
<head>
	<title><%= title %></title>
	<link rel="stylesheet" type="text/css" href="/CSS/book.css">
	<script type="text/javascript"></script>
</head>
<body>
	<div id="header">
		<center><h1 style="color: #00d8ff;">Search results</h1></center>
	</div>
	
	<div class="books_cont">
	<% for(var i = 0; i < issued_book.length; i++){ %>
		<% if(issued_book[i].user_id == null){ %>
		<div class="book_cont">
			<span style="color: #aaa">Book name:</span> <%= issued_book[i].name %>
			<br>
			<span style="color: #aaa">Author:</span> <%= issued_book[i].author %>
			<br>
			<span style="color: #aaa">Book ID:</span> <%= issued_book[i].book_id %>
			<br>
			<span style="float: right; background-color: green; color: #fff; font-weight: bold; padding: 3px;">Book Available</span><br clear="all">
			<input id="<%= issued_book[i].book_id %>" class="roll_input" type="text" name="user_id_input" placeholder="Issue Book To" required><br>
			<button value="<%= issued_book[i].book_id %>" class="issue_btn">Issue Book</button><br clear="all">

		</div>
		<% } else {%>
		<div class="book_cont">

			<span style="color: #aaa">Book ID:</span> <%= issued_book[i].book_id %>
			<span style="float: right; background-color: #ff4800; color: #fff; font-weight: bold;  padding: 3px;">User ID: <%= issued_book[i].user_id %></span><br clear="all">
			<span style="color: #aaa">Due Date:</span> <%= issued_book[i].due_date %><br>
			<button value="<%= issued_book[i].book_id %>" class="return_btn">Return Book</button><br clear="all">

		</div>
		<% } %>
	<% } %>
	</div>

</body>
<script type="text/javascript" src="/JS/jquery-3.3.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	$(".issue_btn").click(function(e){
		e.preventDefault();
		var book_id = $(this).val();
		var issue_to = $("#"+book_id).val(); $("#"+book_id).val('');
		var data = {book_id, issue_to};

		$.ajax({
			type: 'POST',
			url: '/issue_book',
			data,
			success: function() {
				window.location.reload();
			},
			error: function(error) {	
				console.log(error);	
				alert(error.responseText);
				console.log(error.responseText);
			}
		});

	});

	$(".return_btn").click(function(e){
		e.preventDefault();
		var book_id = $(this).val();

		$.ajax({
			type: 'DELETE',
			url: '/return_book',
			data: {book_id},
			success: function() {
				window.location.reload();
			},
			error: function(error) {	
				console.log(error);	
				alert(error.responseText);
				console.log(error.responseText);
			}
		});
	});

});
</script>
</html>